# Проект 2 спринта

## Описание:
Заказ в интернет-магазине — это набор купленных товаров и их количество. Покупатели привыкли получать заказы одномоментно, поэтому каждый заказ из набора товаров формируется в одну сущность доставки.

Интернет-магазину важно видеть, что сроки доставки соблюдаются, а её стоимость соответствует тарифам. Он платит за доставку самостоятельно, и стоимость доставки меняется в зависимости от страны — это базовая сумма, которую учитывает вендор. По договору он дополнительно получает прибыль за счёт комиссии от вендора.

Но сейчас эти данные хранятся в одной таблице, `shipping`, где много дублирующейся и несистематизированной справочной информации. По сути там содержится весь лог доставки от момента оформления до выдачи заказа покупателю.

**Дано**: 
- Таблица `public.shipping`, определение которой можно найти [здесь](./scripts/init.sql).

**Цель**:
- Сделать миграцию в отдельные логические таблицы, а затем собрать на них витрину данных.
  
**Зачем**:
- Это поможет оптимизировать нагрузку на хранилище и позволит аналитикам, перед которыми стоит задача построить анализ эффективности и прибыльности бизнеса, отвечать на точечные вопросы о тарифах вендоров, стоимости доставки в разные страны, количестве доставленных заказов за последнюю неделю. 
  Если искать эти данные в таблице исходных логов доставки, нагрузка на хранилище будет не оптимальна. Придется усложнять запросы, что может привести к ошибкам.
  

### Описание исходных данных

#### Таблица `shipping`(представляет собой последовательность действий при доставке, перечисленную ниже):

Имя столбца | Описание 
--- | ---
`shippingid` | уникальный идентификатор доставки
`saleid` | уникальный идентификатор заказа. К одному заказу может быть привязано несколько строчек `shippingid`, то есть логов, с информацией о доставке
`vendorid` | уникальный идентификатор вендора. К одному вендору может быть привязано множество `saleid` и множество строк доставки
`payment_amount` | сумма платежа (то есть дублирующаяся информация)
`shipping_plan_datetime` | плановая дата доставки
`status` | статус доставки в таблице `shipping` по данному `shippingid`. Может принимать значения `in_progress` — доставка в процессе, либо `finished` — доставка завершена
`state` | промежуточные точки заказа, которые изменяются в соответствии с обновлением информации о доставке по времени `state_datetime`
`state_datetime` | время обновления состояния заказа
`shipping_transfer_description` | строка со значениями `transfer_type` и `transfer_model`, записанными через :. Пример записи — `1p:car`. transfer_type — тип доставки.  `1p` означает, что компания берёт ответственность за доставку на себя, `3p` — что за отправку ответственен вендор. `transfer_model` — модель доставки, то есть способ, которым заказ доставляется до точки: `car` — машиной, `train` — поездом, `ship` — кораблем
`shipping_transfer_rate` | процент стоимости доставки для вендора в зависимости от типа и модели доставки, который взимается интернет-магазином для покрытия расходов
`shipping_country` | страна доставки, учитывая описание тарифа для каждой страны
`shipping_country_base_rate` | налог на доставку в страну, который является процентом от стоимости `payment_amount`
`vendor_agreement_description` | строка, в которой содержатся данные `agreementid`, `agreement_number`, `agreement_rate`, `agreement_commission`, записанные через разделитель :. Пример записи — `12:vsp-34:0.02:0.023`. `agreementid` — идентификатор договора. `agreement_number` — номер договора в бухгалтерии. `agreement_rate` — ставка налога за стоимость доставки товара для вендора. `agreement_commission` — комиссия, то есть доля в платеже являющаяся доходом компании от сделки

  
### Конечный вид модели данных:

![Final Data Model](./images/final_data_model.jpg)

Скрипт создания целевой модели данных можно найти [здесь](./scripts/new_data_model.sql).

